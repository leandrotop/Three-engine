<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Three Environment</title>
    <style>
        *{
            margin: 0px;
            color: #EEEEEE;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        ::-webkit-scrollbar {
            display: none;
        }
        body{
            background-color: #21212b;
        }
        .left{
            background-color: #191A24;
            position: fixed;
            top: 0px;
            left: 0px;
            width: 55px;
            height: 100vh;
            overflow-y: auto;
        }
        .btn_inc{
            background-color: #FFFFFF00;
            border: none;
            font-size: 30px;
            width: 55px;
            height: 55px;
        }
        .screen{
            position: absolute;
            top: 0px;
            left: 55px;
            width: calc(100vw - 55px);
            height: 100vh;
        }
        button{
            font-family: Arial, Helvetica, sans-serif;
            background-color: #191A24;
            border: none;
        }
        h2{
            font-family: Arial, Helvetica, sans-serif;
        }
        textarea{
            font-family: Arial, Helvetica, sans-serif;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.js"></script>
    <script src="lib/deixe.js"></script>
    <script src="app/engine.js"></script>
</head>
<bod id="screen-engine">

    <div id="screen">
    </div>

    <div style="background-color: #ffffff10; display: none; align-items: center; justify-content: center; position: absolute; top: 0px; left: 0px; width: 100vw; height: 100vh;" id="alerta">
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "/lib/build/three.module.js",
                "three/addons/": "/lib/jsm/"
            }
        }
    </script>
    <script src="/lib/jsm/physics/lib-ammo.js"></script>
    <script src="/lib/jsm/nipplejs/nipple.js"></script>
    <script type="module">
        import * as THREE from 'three';
        import Stats from 'three/addons/libs/stats.module.js';
        import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { TransformControls } from 'three/addons/controls/TransformControls.js';
        import { AnimationMixer } from 'three'
        import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
        import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
        import { ColladaLoader } from 'three/addons/loaders/ColladaLoader.js';
        import { Water } from 'three/addons/objects/Water.js';
        import { Sky } from 'three/addons/objects/Sky.js';
        import { Reflector } from 'three/addons/objects/Reflector.js';
    /*

████████ ███████ ██       █████      ██ ███    ██ ██  ██████ ██  █████  ██      
   ██    ██      ██      ██   ██     ██ ████   ██ ██ ██      ██ ██   ██ ██      
   ██    █████   ██      ███████     ██ ██ ██  ██ ██ ██      ██ ███████ ██      
   ██    ██      ██      ██   ██     ██ ██  ██ ██ ██ ██      ██ ██   ██ ██      
   ██    ███████ ███████ ██   ██     ██ ██   ████ ██  ██████ ██ ██   ██ ███████ 
                                                                                
    */

    window._criar_lista_projetos = function () {
        if (localStorage.getItem("engine") != null) {
            let _l_arquivos = JSON.parse(localStorage.getItem("engine"))
            
            document.getElementById('projetos').innerHTML = ""
            for (let _nome in _l_arquivos) {
                document.getElementById('projetos').innerHTML += `
                    <div style="display: flex; flex-direction: column; margin-top: 10px;">
                        <div style="display: flex; flex-direction: row;">
                            <button style="width: 188px; margin-left: 15px; padding: 10px; text-align: start;" onclick="_abrir_projeto('${_nome}')">${_nome}</button>
                            <button style="width: 40px; margin-left: 2px; padding: 10px;" onclick="_abrir_mais_opecao_projeto('${_nome}')">+</button>
                        </div>
                        <div style="display: none;" id="opecao-${_nome}">
                            <button style="width: 230px; margin-left: 15px; padding: 10px; margin-top: 2px;" onclick="">Save</button>
                            <button style="width: 230px; margin-left: 15px; padding: 10px; margin-top: 2px;" onclick="">Delete</button>
                            <button style="width: 230px; margin-left: 15px; padding: 10px; margin-top: 2px;" onclick="">Edit</button>
                            <button style="width: 230px; margin-left: 15px; padding: 10px; margin-top: 2px;" onclick="">Export</button>
                        </div>
                    </div>
                `
            }
        }
    }

    window._abrir_tela_criar_projeto = function () {
        if (document.getElementById('tela-de-criar').style.display == 'flex') {
            document.getElementById('tela-de-criar').style.display = 'none'
        } else {
            document.getElementById('tela-de-criar').style.display = 'flex'
        }
    }
    window._criar_projeto = async function () {
        try{
            let _l_projetos = await _engine_projeto_criar(document.getElementById("inp-nome").value)
            if (_l_projetos.resultado) {
                _criar_lista_projetos()
                _abrir_tela_criar_projeto()
            } else {
                _engine_abrir_alerta("alerta", _l_projetos.erro)
            }
            
        }
        catch{}
    }

    window._abrir_mais_opecao_projeto = function (_nome) {
        if (_engine_atual_projeto == _nome) {
            if (document.getElementById("opecao-"+_nome).style.display == "none") {
                document.getElementById("opecao-"+_nome).style.display = "block"
            } else {
                document.getElementById("opecao-"+_nome).style.display = "none"
            }
        }
    }
    
    window._abrir_projeto = function (_nome) {
        _engine_projeto_ler(_nome)
        _engine_tela_engine()
        _abrir_editor_world()
        initEngine()
    }

    _engine_tela_inicial()
    _criar_lista_projetos()

    /*

████████ ███████ ██       █████      ███    ███ ███████ ███    ██ ██    ██ 
   ██    ██      ██      ██   ██     ████  ████ ██      ████   ██ ██    ██ 
   ██    █████   ██      ███████     ██ ████ ██ █████   ██ ██  ██ ██    ██ 
   ██    ██      ██      ██   ██     ██  ██  ██ ██      ██  ██ ██ ██    ██ 
   ██    ███████ ███████ ██   ██     ██      ██ ███████ ██   ████  ██████  
                                                                           
    */

    window._voltar_parar_menu = function () {
        _engine_tela_inicial()
        _criar_lista_projetos()
    }

    window._voltar_parar_engine = function () {
        _abrir_projeto(_engine_atual_projeto)
    }

/*

███████ ██████  ██ ████████  ██████  ██████      ██     ██  ██████  ██████  ██      ██████  
██      ██   ██ ██    ██    ██    ██ ██   ██     ██     ██ ██    ██ ██   ██ ██      ██   ██ 
█████   ██   ██ ██    ██    ██    ██ ██████      ██  █  ██ ██    ██ ██████  ██      ██   ██ 
██      ██   ██ ██    ██    ██    ██ ██   ██     ██ ███ ██ ██    ██ ██   ██ ██      ██   ██ 
███████ ██████  ██    ██     ██████  ██   ██      ███ ███   ██████  ██   ██ ███████ ██████  
                                                                                            
*/

    window._abrir_editor_world = function () {
        _exibir_pastas_world()
    }

    window._criar_pasta_world = function () {
        _engine_arquivo_world_criar_pasta(document.getElementById("input-alerta").value)
        _engine_fechar_alerta()
        _exibir_pastas_world()
    }

    window._exibir_pastas_world = function () {
        document.getElementById('arquivos').innerHTML = `
        <div style="width: 100%;">
            <button style="background-color: #191A24; width: calc(100% - 18px); border-left: solid 5px #ffbb00; text-align: left; margin-left: 10px; margin-top: 10px; margin-bottom: 10px; padding: 10px;" onclick="_engine_abrir_alerta('input', '_criar_pasta_world()')">Create world folder</button>
        </div>`
        for (let _pasta in engine.world) {
            document.getElementById('arquivos').innerHTML += `
            <div style="width: 100%;">
                <button style="width: calc(100% - 20px); border-left: solid 5px #ff0000; text-align: left; margin-left: 10px; margin-bottom: 2px; padding: 10px;" onclick="">${_pasta}</button>
            </div>`
        }
    }

/*

███████ ██████  ██ ████████  ██████  ██████       ██████  ██████       ██ ███████ ████████  ██████  
██      ██   ██ ██    ██    ██    ██ ██   ██     ██    ██ ██   ██      ██ ██         ██    ██    ██ 
█████   ██   ██ ██    ██    ██    ██ ██████      ██    ██ ██████       ██ █████      ██    ██    ██ 
██      ██   ██ ██    ██    ██    ██ ██   ██     ██    ██ ██   ██ ██   ██ ██         ██    ██    ██ 
███████ ██████  ██    ██     ██████  ██   ██      ██████  ██████   █████  ███████    ██     ██████  
                                                                                                    
*/

    window._abrir_editor_objeto = function () {
        _exibir_pastas_objeto()
    }

    window._criar_pasta_objeto = function () {
        _engine_arquivo_objeto_criar_pasta(document.getElementById("input-alerta").value)
        _engine_fechar_alerta()
        _exibir_pastas_objeto()
    }

    window._exibir_pastas_objeto = function () {
        document.getElementById('arquivos').innerHTML = `
        <div style="width: 100%;">
            <button style="background-color: #191A24; width: calc(100% - 18px); border-left: solid 5px #ffbb00; text-align: left; margin-left: 10px; margin-top: 10px; margin-bottom: 10px; padding: 10px;" onclick="_engine_abrir_alerta('input', '_criar_pasta_objeto()')">Create object folder</button>
        </div>`
        for (let _pasta in engine.object) {
            document.getElementById('arquivos').innerHTML += `
            <div style="width: 100%;">
                <button style="width: calc(100% - 20px); border-left: solid 5px #ff0000; text-align: left; margin-left: 10px; margin-bottom: 2px; padding: 10px;" onclick="">${_pasta}</button>
            </div>`
        }
    }

/*

███████ ███    ██  ██████  ██ ███    ██ ███████ 
██      ████   ██ ██       ██ ████   ██ ██      
█████   ██ ██  ██ ██   ███ ██ ██ ██  ██ █████   
██      ██  ██ ██ ██    ██ ██ ██  ██ ██ ██      
███████ ██   ████  ██████  ██ ██   ████ ███████ 
                                                
*/

    let scene, camera, controls
    window.initEngine = function () {
        const container = document.getElementById('container')
        let renderer = new THREE.WebGLRenderer()
        renderer.setSize(container.clientWidth, container.clientHeight)
        renderer.toneMapping = THREE.ACESFilmicToneMapping
        renderer.toneMappingExposure = 0.5
        renderer.shadowMap.enabled = true
        container.appendChild(renderer.domElement)

        scene = new THREE.Scene()
        scene.background = new THREE.Color(0x7e7e7e)

        camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000)
        camera.position.set(0, 1, 0)

        function render() {
            renderer.render(scene, camera)
            requestAnimationFrame(render)
        }
        render()
    }
    </script>

</body>
</html>